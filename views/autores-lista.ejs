<!DOCTYPE html>
<html>
  <head>
    <title>Listagem de Autores</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <h1 class="text-center mb-4">Listagem de Autores</h1>
      <a href="/autores/add" class="btn btn-success mb-2">Incluir</a>

      <table class="table table-bordered table-striped table-hover shadow">
        <thead class="table-dark">
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Autor</th>
            <th scope="col">Nacionalidade</th>
            <th scope="col">Operações</th>
          </tr>
        </thead>
        <tbody>
          <% for (let item of resultado) { %>
            <tr id="linha-<%= item.IdAutor %>">
              <td><%= item.IdAutor %></td>
              <td><%= item.NoAutor %></td>
              <td><%= item.NoNacionalidade %></td>
              <td>
                <a href="/autores/editar/<%= item.IdAutor %>" class="btn btn-primary btn-sm">Alterar</a>
                <button class="btn btn-danger btn-sm btn-deletar" data-id="<%= item.IdAutor %>">Deletar</button>
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <script>
      $(document).ready(function(){
        $(".btn-deletar").click(function(){
          if(!confirm("Tem certeza que deseja deletar este autor?")) return;

          const id = $(this).data("id");

          $.ajax({
            url: `/autores/deletar/${id}`,
            type: "DELETE",
            success: function(){
              // Remove a linha da tabela sem recarregar
              $(`#linha-${id}`).remove();
            },
            error: function(err){
              alert("Erro ao deletar autor: " + err.responseText);
            }
          });
        });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
